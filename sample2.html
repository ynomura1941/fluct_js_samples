<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JSONP API</title>
<script type="text/javascript" charset="UTF-8" src="./jquery-1.8.0.js"></script>
<script type="text/javascript" charset="UTF-8" src="./jquery.tools.min.js"></script>

<script type="text/javascript" charset="UTF-8">
$(function(){
  var ua_list = [
'',
'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_0_1 like Mac OS X; ja-jp) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8A306 Safari/6531.22.7',
'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_0_2 like Mac OS X; ja-jp) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8A400 Safari/6531.22.7',
'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_1 like Mac OS X; ja-jp) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8B117 Safari/6531.22.7',
'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_2_1 like Mac OS X; ja-jp) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148 Safari/6533.18.5',
'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3 like Mac OS X; ja-jp) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8F190 Safari/6533.18.5',
'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_1 like Mac OS X; ja-jp) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8G4 Safari/6533.18.5',
'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_2 like Mac OS X; en-us) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8H7 Safari/6533.18.5',
'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_3 like Mac OS X; ja-jp) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5',
'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_4 like Mac OS X; ja-jp) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8K2 Safari/6533.18.5',
'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_5 like Mac OS X; ja-jp) AppleWebKit/533.17.9 (KHTML, like Gecko) Mobile/8L1',
'Mozilla/5.0 (iPhone; U; CPU iPhone OS 5_0 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Mobile/9A334 Safari/7534.48.3',
'Mozilla/5.0 (iPhone; CPU iPhone OS 5_0_1 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Mobile/9A405 Safari/7534.48.3',
'Mozilla/5.0 (Linux; U; Android 2.1-update1; ja-jp; SonyEricssonSO-01B Build/2.0.2.B.0.29) AppleWebKit/530.17 (KHTML, like Gecko) Version/4.0 Mobile Safari/530.17',
'Mozilla/5.0 (Linux; U; Android 2.2.1; ja-jp; Full Android Build/MASTER) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',
'Mozilla/5.0 (Linux; U; Android 2.2.1; ja-jp; IS03 Build/S9090) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',
'Mozilla/5.0 (Linux; U; Android 2.3.3; ja-jp; SC-02C Build/GINGERBREAD) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',
'Mozilla/5.0 (Linux; U; Android 2.3.3; ja-jp; INFOBAR A01 Build/S9081) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',
'Mozilla/5.0 (Linux; U; Android 2.3.3; ja-jp; 001HT Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',
'Mozilla/5.0 (Linux; U; Android 2.3.3; ja-jp; SonyEricssonX10i Build/3.0.1.G.0.75) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',
'Mozilla/5.0 (Linux; U; Android 2.3.4; ja-jp; SonyEricssonIS11S Build/4.0.1.B.0.112) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',
'Mozilla/5.0 (Linux; U; Android 2.3.4; ja-jp; IS05 Build/S9290) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',
'Mozilla/5.0 (Linux; U; Android 2.3.5; ja-jp; F-05D Build/F0001) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',
'Mozilla/5.0 (Linux; U; Android 2.3.5; ja-jp; T-01D Build/F0001) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1',
'Mozilla/5.0 (Linux; U; Android 3.0.1; ja-jp; MZ604 Build/H.6.2-20) AppleWebKit/534.13 (KHTML, like Gecko) Version/4.0 Safari/534.13',
'Mozilla/5.0 (Linux; U; Android 3.1; en-us; K1 Build/HMJ37) AppleWebKit/534.13(KHTML, like Gecko) Version/4.0 Safari/534.13',
'Mozilla/5.0 (Linux; U; Android 3.1; ja-jp; AT100 Build/HMJ37) AppleWebKit/534.13 (KHTML, like Gecko) Version/4.0 Safari/534.13',
'Mozilla/5.0 (Linux; U; Android 3.1; ja-jp; Sony Tablet S Build/THMAS10000) AppleWebKit/534.13 (KHTML, like Gecko) Version/4.0 Safari/534.13',
'Mozilla/5.0 (Linux; U; Android 3.2; ja-jp; SC-01D Build/MASTER) AppleWebKit/534.13 (KHTML, like Gecko) Version/4.0 Safari/534.13',
'Mozilla/5.0 (Linux; U; Android 3.2; ja-jp; AT1S0 Build/HTJ85B) AppleWebKit/534.13 (KHTML, like Gecko) Version/4.0 Safari/534.13',
'Mozilla/5.0 (Linux; U; Android 3.2; ja-jp; F-01D Build/F0001) AppleWebKit/534.13 (KHTML, like Gecko) Version/4.0 Safari/534.13',
'Mozilla/5.0 (Linux; U; Android 3.2; ja-jp; Sony Tablet S Build/THMAS11000) AppleWebKit/534.13 (KHTML, like Gecko) Version/4.0 Safari/534.13',
'Mozilla/5.0 (Linux; U; Android 3.2; ja-jp; A01SH Build/HTJ85B) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Safari/533.1',
'Mozilla/5.0 (Linux; U; Android 3.2.1; ja-jp; Transformer TF101 Build/HTK75) AppleWebKit/534.13 (KHTML, like Gecko) Version/4.0 Safari/534.13'
                 ];
  
  $.each(ua_list, function(idx, val){
    var opt = $('<option>');
    opt.attr({value: val});
    opt.html(val);
    opt.appendTo($('#in_ua'));
    
  });
  
  for(var i = 1; i <= 100; i++){
    var opt = $('<option>');
    opt.attr({value: i});
    opt.html(i);
    opt.appendTo($('#in_age'));
  }
  
  $(document).delegate('#btn_getAd', 'click', function(){
    var gid = $('#in_gid').val();
    var seg = $('#in_seg').val();
    var ua  = $('#in_ua option:selected').val();
    var ip  = $('#in_ip').val();
    var ref = $('#in_ref').val();
    var gen = $("[name='in_gen']:checked").val();
    var age = $('#in_age option:selected').val();
    var param = {};
    param.G = gid;
    if(seg !== ''){
      param.seg = seg;
    }
    if(ua !== ''){
      param.ua = ua;
    }
    if(ref !== ''){
      param.ref = ref;
    }
    if(ip !== ''){
      param.ip = ip;
    }
    if(gen !== ''){
      param.gen = gen;
    }
    if(age !== ''){
      param.age = age;
    }
    
    $.ajax({
      type: 'get',
      url: 'http://sh.adingo.jp.pre.fluct.jp/api/json/v1/',
      data: param,
      dataType: 'jsonp',
      cache: false,
      jsonp: 'cb',
      success: function(json){
      if( json.status !== 'success'){
        $('#result').html('エラーが発生したようです。');
      }
      else{
        render(json);
      }
      },
      error: function(){
        $('#result').html('エラーが発生したようです。');
      }
    
    });
/*    
    $.getJSON('http://sh.adingo.jp.pre.fluct.jp/api/json/v1/', param, function(data){
      if( data.status !== 'success'){
        $('#result').html('エラーが発生したようです。');
      }
      else{
        render(data);
      }
    });
*/  
  });

  function render(json){
    $('#result').html('');
    var target = $("[name='in_target']:checked").val();
    
    if( json.sync !== '' ){
      var sync = $('<img style="position:absolute;border:none;padding:0;margin:0;">');
      sync.attr({src: json.sync});
      sync.height = 1;
      sync.width  = 1;
      sync.appendTo('#result');
    }
    
    $.each(json.ads, function(idx, val){
      var beacon = $('<img style="position:absolute;border:none;padding:0;margin:0;">');
      beacon.attr({src: val.beacon});
      beacon.height = 1;
      beacon.width  = 1;
      beacon.appendTo('#result');

      var div = $('<div>');
      div.attr({id: val.unit_id});
      div.height(val.height);
      div.width(val.width);
      div.appendTo('#result');

      if( val.creative_type === 'image'){
        var img = $('<img>');
        var link = $('<a>');
        img.attr({
          src: val.creative_url,
          width: val.width,
          height: val.height,
          alt: json_str_decode(val.alt)
        });
        img.appendTo(link);
        link.attr({
          target: target,
          href: val.landing_url
        });
        link.appendTo(div);
      }
      else if(val.creative_type === 'flash'){
        flashembed(String(val.unit_id), val.creative_url, {
          targetTAG: target,
          clickTAG: val.landing_url
          });
      }
      else if(val.creative_type === 'html'){
        var frame = $('<iframe style="border:none;padding:0;margin:0;" marginwidth="0" marginheight="0" allowtransparency="false" hspace="0" vspace="0" frameborder="0" scrolling="no">');
        frame.attr({width: val.width, height: val.height});
        div.html(frame);
        setTimeout( function() {
          var doc = frame[0].contentWindow.document.write(val.html);
        },10);
      }
      else{
          $('#result').append('no ad:'+ val.unit_id);
      }
    });
  }
});

function fpCheck(){
  var userAgent = window.navigator.userAgent.toLowerCase();
  if (userAgent.indexOf('msie') != -1) {
    try{
      if( typeof new ActiveXObject('ShockwaveFlash.ShockwaveFlash') !== 'undefined' ){
        alert(new ActiveXObject('ShockwaveFlash.ShockwaveFlash').FlashVersion().toString());
      }
    }
    catch(e){
      alert('none');
    
    }
    
  }
  else{
    if( typeof navigator.plugins["Shockwave Flash"] !== 'undefined' ){
      alert( navigator.plugins["Shockwave Flash"].description.charAt(16) );
    }
    else{
      alert('none');
    }
  }
  return false;
};
function json_str_decode(str){
    arrs=str.match(/\\u.{4}/g);
    var t="";
    if( arrs == null ){
      return '';
    }
    for(i=0;i<arrs.length;i++){
        t+=String.fromCharCode(arrs[i].replace("\\u","0x"));
    }
    return(t);
}
</script>
</head>
<body>
<div id="form_area">
<h2>パラメータ</h2>
<div id="input_area">
<label for="in_gid">GROUP ID:</label><input id="in_gid" type="text" name="gid" value=""/><br/>
<label for="in_seg">SEGMENT ID:</label><input id="in_seg" type="text" name="seg" value=""/><br/>
<label for="in_ua">USER AGENT:</label><select id="in_ua"></select><br/>
<label for="in_ref">REFERRER:</label><input id="in_ref" type="text" name="ref" value=""/><br/>
<label for="in_ip">IP ADDRESS:</label><input id="in_ip" type="text" name="ip" value=""/><br/>
<label for="in_gen_1">男:</label><input id="in_gen_1" name="in_gen" type="radio" value="0"/>
<label for="in_gen_1">女:</label><input id="in_gen_2" name="in_gen" type="radio" value="1"/><br/>
<label for="in_age">年齢:</label><select id="in_age"></select><br/>
</div>
<div>
<h2>遷移先表示ウィンドウ</h2>
<label for="in_target_1">同じ:</label><input id="in_target_1" name="in_target" type="radio" value="_top" />
<label for="in_target_2">無名新規ウィンドウ:</label><input id="in_target_2" name="in_target" type="radio" value="_blank"checked="checked"/>
</div>

<a href="javascript:void(0);" onclick="fpCheck();">flash version check</a>
<div id="button_area">
<input id="btn_getAd" type="button" name="getAd" value="取得"/>
</div>
</div>
<div id="result">
</div>
</body>
</html>